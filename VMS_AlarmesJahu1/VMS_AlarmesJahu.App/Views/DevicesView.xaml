<UserControl x:Class="VMS_AlarmesJahu.App.Views.DevicesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="350"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Style="{DynamicResource CardBorder}" Margin="0,0,10,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Margin="0,0,0,16">
                    <TextBlock Text="ðŸ“¦ Dispositivos" FontSize="18" FontWeight="Bold"/>
                    <TextBlock Text="DVRs e NVRs cadastrados" Opacity="0.7"/>
                </StackPanel>

                <ListView Grid.Row="1" x:Name="LvDevices" Background="Transparent" BorderThickness="0"
                          SelectionChanged="LvDevices_SelectionChanged">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{DynamicResource Card}" CornerRadius="8" Padding="12" Margin="0,0,0,8">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="{Binding Device.Name}" FontWeight="SemiBold" FontSize="14"/>
                                        <TextBlock Text="{Binding Device.GetConnectionInfo}" Opacity="0.7" Margin="0,4,0,0" FontSize="12"/>
                                        <TextBlock Text="{Binding StatusText}" Margin="0,4,0,0" FontSize="12"/>
                                    </StackPanel>
                                    <Button Grid.Column="1" Content="ðŸ”Œ" Click="BtnConnect_Click" Tag="{Binding}" VerticalAlignment="Center" Padding="8,4"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,12,0,0">
                    <Button x:Name="BtnAdd" Content="âž• Adicionar" Padding="12,6" Margin="0,0,8,0"/>
                    <Button x:Name="BtnRefresh" Content="ðŸ”„ Atualizar" Padding="12,6"/>
                </StackPanel>
            </Grid>
        </Border>

        <Border Grid.Column="1" Style="{DynamicResource CardBorder}" x:Name="PanelDetails">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="âš™ï¸ ConfiguraÃ§Ãµes" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>

                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Nome" Margin="0,0,0,4"/>
                        <TextBox x:Name="TxtName" Height="36" Margin="0,0,0,12"/>
                        
                        <TextBlock Text="Tipo de ConexÃ£o" Margin="0,0,0,4"/>
                        <ComboBox x:Name="CmbConnectionType" Height="36" Margin="0,0,0,12" 
                                  SelectionChanged="CmbConnectionType_SelectionChanged">
                            <ComboBoxItem Content="ConexÃ£o Direta (IP:Porta)" Tag="Direct"/>
                            <ComboBoxItem Content="Cloud P2P (NÃºmero de SÃ©rie)" Tag="P2PCloud"/>
                        </ComboBox>

                        <!-- Campos para ConexÃ£o Direta -->
                        <StackPanel x:Name="PanelDirect">
                            <TextBlock Text="Host/IP" Margin="0,0,0,4"/>
                            <TextBox x:Name="TxtHost" Height="36" Margin="0,0,0,12"/>
                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                    <TextBlock Text="Porta" Margin="0,0,0,4"/>
                                    <TextBox x:Name="TxtPort" Height="36" Text="37777"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                    <TextBlock Text="Canais" Margin="0,0,0,4"/>
                                    <TextBox x:Name="TxtChannels" Height="36" Text="16"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>

                        <!-- Campos para P2P Cloud - CORRIGIDO COM PORTA -->
                        <StackPanel x:Name="PanelP2P" Visibility="Collapsed">
                            <TextBlock Text="NÃºmero de SÃ©rie (SN)" Margin="0,0,0,4"/>
                            <TextBox x:Name="TxtSerialNumber" Height="36" Margin="0,0,0,12" 
                                     ToolTip="Ex: 1234567890ABCDEF ou 4J0XXXX"/>
                            
                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                    <TextBlock Text="Porta P2P" Margin="0,0,0,4"/>
                                    <TextBox x:Name="TxtPortP2P" Height="36" Text="37777" 
                                             ToolTip="Porta padrÃ£o: 37777 (DVR/NVR Intelbras)"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                    <TextBlock Text="Canais" Margin="0,0,0,4"/>
                                    <TextBox x:Name="TxtChannelsP2P" Height="36" Text="16"/>
                                </StackPanel>
                            </Grid>
                            
                            <Border Background="#2d3748" CornerRadius="4" Padding="10" Margin="0,0,0,12">
                                <StackPanel>
                                    <TextBlock Text="ðŸ’¡ Dicas Cloud P2P:" FontWeight="SemiBold" Margin="0,0,0,6"/>
                                    <TextBlock Text="â€¢ O nÃºmero de sÃ©rie estÃ¡ na etiqueta do DVR/NVR" Opacity="0.8" FontSize="11"/>
                                    <TextBlock Text="â€¢ Porta padrÃ£o: 37777 (modifique se alterou no DVR)" Opacity="0.8" FontSize="11"/>
                                    <TextBlock Text="â€¢ Certifique-se que o dispositivo estÃ¡ online na nuvem" Opacity="0.8" FontSize="11"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <TextBlock Text="UsuÃ¡rio" Margin="0,0,0,4"/>
                        <TextBox x:Name="TxtUser" Height="36" Margin="0,0,0,12" Text="admin"/>
                        <TextBlock Text="Senha" Margin="0,0,0,4"/>
                        <PasswordBox x:Name="TxtPassword" Height="36" Margin="0,0,0,12"/>
                        <CheckBox x:Name="ChkEnabled" Content="Dispositivo Habilitado" Margin="0,0,0,12" IsChecked="True"/>
                    </StackPanel>
                </ScrollViewer>

                <StackPanel Grid.Row="2" Orientation="Horizontal">
                    <Button x:Name="BtnSave" Content="ðŸ’¾ Salvar" Padding="16,8" Margin="0,0,8,0"/>
                    <Button x:Name="BtnDelete" Content="ðŸ—‘ï¸ Excluir" Padding="16,8" Margin="0,0,8,0"/>
                    <Button x:Name="BtnTestConnection" Content="ðŸ”— Testar ConexÃ£o" Padding="16,8"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
